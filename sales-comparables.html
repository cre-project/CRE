<!DOCTYPE HTML>
<html>
	<head>
		<title></title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="my.css" />
	</head>
	<body>
		<header>
            <div class="header-image"  id="logo-small" onclick="location.href='index.html';">
                <img class="header-image" src="t-logo-small.png" alt="Your logo here" />
            </div>
			<div id="menu">
                <div id="label">BETA</div>
                Marvin
				<div id="symbol">&#8964;</div>
                <div class="header-image" id="search">
                    <img class="header-image"  src="search-icon.png" alt="Seach" />
                </div>
			</div> 
		</header>
		<header id="sub-header">
			<nav>
				<ul>
					<li><a href="property-info.html">PROPERTY INFO</a></li>
					<li><a href="unit-mix.html">UNIT MIX</a></li>
					<li><a href="operating-statement.html">OPERATING STATEMENT</a></li>
					<li id="selected"><a>SALES COMPARABLES</a></li>
					<li><a href="rent-comparables.html">RENT COMPARABLES</a></li>
					<li><a href="preview.html">PREVIEW</a></li>
				</ul>
			</nav>
        </header>
        <div class="wrapper" id="main">
            <h1>Sales Comps</h1>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Price</th>
                    <th>Cap Rate</th>
                    <th># of Units</th>
                    <th></th>
                </tr>
            </table>
            <div id="add-more">
                <span class="add-more-content">Add a Unit</span>
                <div class="add-more-content" id="plus">+</div>
                <span class="add-more-content text ita bold hidden">Property Information</span>
                <span class="add-more-content text ita bold hidden" id="right">Financial Information</span>
                    <div class="hidden popup-form">
                        <!-- part 1 of the form -->
                        <form id="form-1">
                            <label>
                                <div>Property Name</div>
                                <input placeholder="North Beach Villa">
                            </label>
                            <label>
                                <div>Property Address</div>
                                <input placeholder="690 Chestnut Street">
                            </label>
                            <label>
                                <div>City</div>
                                <input placeholder="San Francisco">
                            </label>
                        </form>
                        <!-- part 2 of the form -->
                        <form id="form-2">
                            <label class="half-size">
                                <div class="half-size">State</div>
                                <input class="half-size" placeholder="CA">
                            </label>
                            <label class="half-size">
                                <div class="half-size">ZIP</div>
                                <input class="half-size" placeholder="94911">
                            </label>
                            <label class="half-size">
                                <div class="half-size">Year built</div>
                                <input class="half-size" placeholder="1978">
                            </label>
                        </form>
                        <!-- part 3 of the form -->
                        <form id="form-3">
                            <label class="half-size">
                                <div class="half-size">Sales Price</div>
                                <input class="half-size" placeholder="$3,400,000">
                            </label>
                            <label class="half-size">
                                <div class="half-size">Total # of Units</div>
                                <input class="half-size" placeholder="16">
                            </label>
                            <label class="half-size">
                                <div class="half-size">Total Price/Unit</div>
                                <input class="half-size" placeholder="$212,500">
                            </label>
                        </form>
                        <!-- part 4 of the form -->
                        <form id="form-4">
                            <label class="half-size">
                                <div class="half-size">Cap Rate</div>
                                <input class="half-size" placeholder="4.2%">
                            </label>
                            <label class="half-size">
                                <div class="half-size">GRM</div>
                                <input class="half-size" placeholder="12.12">
                            </label>
                            <label class="half-size">
                                <div class="half-size">Price/SF</div>
                                <input class="half-size" placeholder="$138.22">
                            </label>
                        </form>
                    </div>
            </div>
            <button class="save" type="submit" onclick="location.href='rent-comparables.html';">Save & Next</button>
        </div>
        <script>
            const table = document.getElementsByTagName('table')[0]
            const editButton = document.querySelector('.editable')
            const form = document.querySelector('.popup-form')
            const plus = document.getElementById('plus')
            const addMore = document.getElementById('add-more')
            const text = document.querySelectorAll('span')
            const saveButton = document.querySelector('.save')

            const wrapper = document.querySelector('#main')

            plus.addEventListener('click', function(evt) {
                if (evt.target.classList.contains('ok')) {
                    // closing popup
                    wrapper.classList.remove('resized')
                    addMore.classList.remove('expanded')
                    wrapper.classList.remove('resized')
                    saveButton.classList.remove('hidden')
                    plus.classList.remove('ok')
                    plus.textContent = '+'
                    
                    form.classList.add('hidden')
                    text.forEach(function(t) {
                        if (t.classList.contains('text')) {
                            t.classList.add('hidden') 
                        } else { 
                            t.classList.remove('hidden')
                        }
                    })
                    
                    addNewRow()
                } else {
                    // opening popup
                    saveButton.classList.add('hidden')
                    addMore.classList.add('expanded')
                    wrapper.classList.add('resized')
                    plus.classList.add('ok')
                    plus.textContent = 'ok'

                    form.classList.remove('hidden')
                    text.forEach(function(t) {
                        if (t.classList.contains('text')) {
                            t.classList.remove('hidden') 
                        } else { 
                            t.classList.add('hidden')
                        }
                    })
                }
            })

            // FIXME add edit button
            editButton.addEventListener('click', function(evt) {
                console.log('hello')
                if (evt.target.classList.contains('inline-edit')) return
                this.querySelectorAll('input').forEach(elem => elem.hasAttribute('disabled') ? elem.removeAttribute('disabled') : elem.setAttribute('disabled', ''))
            })


            function addNewRow() {
                const newRow = table.insertRow(table.rows.length);

                const cell1 = newRow.insertCell(0);
                const cell2 = newRow.insertCell(1);
                const cell3 = newRow.insertCell(2);
                const cell4 = newRow.insertCell(3);
                const cell5 = newRow.insertCell(4);
                const cell6 = newRow.insertCell(5);
                cell6.classList.add('editable')

                const percent = document.createElement('span')
                const editIcon = document.createElement('i')

                let inputs = []
                for (var i = 1; i < 6; i ++) {
                    inputs.push(document.createElement('input'))
                } 
                inputs.forEach(element => {
                    // element.classList.add('inline-edit')
                    element.classList.add('disabled')
                });

                editIcon.classList.add('medium')
                editIcon.classList.add('material-icons')
                editIcon.innerText = 'edit'
                // percent.innerText = '%';
                // cell3.innerText = '$';

                // FIXME use user input - now adding default data
                cell1.innerText = 'North Beach Villa'
                cell2.innerText = '690 Chestnut Street, San Francisco, CA 94911'
                cell3.innerText = '$4,800,000'
                cell4.innerText = '4.3%'
                cell5.innerText = '14'

                cell1.appendChild(inputs[0]);
                cell2.appendChild(inputs[1]);
                cell3.appendChild(inputs[2]);
                cell4.appendChild(inputs[3]);
                cell4.appendChild(percent)
                cell5.appendChild(inputs[4]);
                cell6.appendChild(editIcon);
            }
        </script>
	</body>
</html>