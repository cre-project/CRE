<!DOCTYPE HTML>
<html>
	<head>
		<title></title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
		<link rel="stylesheet" href="my.css" />
	</head>
	<body>
		<header>
            <div class="header-image"  id="logo-small">
                <img class="header-image" src="t-logo-small.png" alt="Your logo here" />
            </div>
			<div id="menu">
                <div id="label">BETA</div>
                Marvin
				<div id="symbol">&#8964;</div>
                <div class="header-image" id="search">
                    <img class="header-image"  src="search-icon.png" alt="Search" />
                </div>
			</div> 
		</header>
		<header id="sub-header">
			<nav>
				<ul>
					<li><a href="property-info.html">PROPERTY INFO</a></li>
					<li><a href="unit-mix.html">UNIT MIX</a></li>
					<li id="selected"><a>OPERATING STATEMENT</a></li>
					<li><a href="sales-comparables.html">SALES COMPARABLES</a></li>
					<li><a href="rent-comparables.html">RENT COMPARABLES</a></li>
					<li><a href="visuals.html">VISUALS</a></li>
					<li><a href="preview.html">PREVIEW</a></li>
				</ul>
			</nav>
		</header>
		<div class="two-columns">
			<h1 id="tc-header">Operating Statement</h1>
			<main>
				<table id="os">
					<thead>
						<tr>
							<th class="sub-section l-align bolder" colspan="2">Income</th>
							<th class="sub-section">Current</th>
							<th class="sub-section">Pro Forma</th>
						</tr>
					</thead>
					<tr class="total">
						<td class="l-align bold" colspan="2">GROSS POTENTIAL RENT</td>
						<td>$<span id="gpr-current">200000</span></td>
						<td>$<span id="gpr-future">200000</span></td>
					</tr>
					<tr>
						<td>Less: Vacancy/Deduction</td>
						<td class="setting"><button class="percent" id="vacancy-plus">+</button><span id="vacancy">  5</span>% <button class="percent" id="vacancy-minus">-</button></td>
						<td>- $<span id="vacancy-current">5000.00</span></td>
						<td>- $<span id="vacancy-future">5000.00</span></td>
					</tr>
					<tr class="total">
						<td class="l-align bold" colspan="2">EFFECTIVE RENTAL INCOME</td>
						<td>$200,000</td>
						<td>$200,000</td>
					</tr>
					<tr>
						<td class="sub-section l-align bolder" span="4">Expenses</td>
					</tr>
					<tr>
						<td class="l-align">Real Estate Taxes</td>
						<td class="setting"><button class="percent" id="taxes-plus">+</button><span id="taxes">  5</span>% <button class="percent" id="taxes-minus">-</button></td>
						<td id="taxes-current">5000.00</td>
						<td id="taxes-future">5000.00</td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Insurance</td>
						<td><input class="inline-edit" value="300"></td>
						<td><input class="inline-edit" value="300"></td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Utilities - Electric</td>
						<td><input class="inline-edit" value="430.00"></td>
						<td><input class="inline-edit" value="430.00"></td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Utilities - Water & Sewer</td>
						<td><input class="inline-edit" value="320.00"></td>
						<td><input class="inline-edit" value="320.00"></td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Garbage</td>
						<td><input class="inline-edit" value="934.34"></td>
						<td><input class="inline-edit" value="934.34"></td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Repairs & Maintenance</td>
						<td><input class="inline-edit" value="4.00"></td>
						<td><input class="inline-edit" value="4.00"></td>
					</tr>
					<tr>
						<td class="l-align">Management Fee</td>
						<td class="setting"><button class="percent" id="mgmt-fee-plus">+</button>&nbsp;<span id="mgmt-fee">5</span>% <button class="percent" id="mgmt-fee-minus">-</button></td>
						<td id="mgmt-fee-current">329.00</td>
						<td id="mgmt-fee-future">329.00</td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Landscaping</td>
						<td><input class="inline-edit" value="239.00"></td>
						<td><input class="inline-edit" value="239.00"></td>
					</tr>
					<tr>
						<td class="l-align" colspan="2">Other Expenses</td>
						<td><input class="inline-edit" value="400.00"></td>
						<td><input class="inline-edit" value="400.00"></td>
					</tr>
					<tr class="total">
						<td class="l-align bold" colspan="2">TOTAL EXPENSES</td>
						<td>$200,000</td>
						<td>$200,000</td>
					</tr>
					<tr>
						<td class="l-align bold" colspan="2">Net Operating Income</td>
						<td class="bold">$45,498.00</td>
						<td class="bold">$45,498.00</td>
					</tr>
				</table>
				<button class="save" id="operating-statement" type="submit" onclick="location.href='sales-comparables.html'">Save & Next</button>
			</main>
			<aside class="total">
				<div class="side-form">
						<div class="bold l-align">Price</div>
						<input type="text" id="os-right" value="$">
						<p class="bold l-align">Price/Unit: <span>$250000</span></br>Price/SF: <span>$200.10</span></p>
				</div>
					<table>
						<thead>
							<tr>
								<th></th>
								<th>Current</th>
								<th>Pro Forma</th>
							</tr>
						</thead>
						<tr>
							<td>CAP Rate</td>
							<td>5.50%</td>
							<td>6.00%</td>
						</tr>
						<tr>
							<td>GRM</td>
							<td>12.1</td>
							<td>9.21</td>
						</tr>
					</table>
			</aside>
		</div>
		<script>
			// increase and decrease buttons
			const txInc = document.querySelector('#taxes-plus')
			const txDec = document.querySelector('#taxes-minus')
			const mgmtInc = document.querySelector('#mgmt-fee-plus')
			const mgmtDec = document.querySelector('#mgmt-fee-minus')
			const vacancyInc = document.querySelector('#vacancy-plus')
			const vacancyDec = document.querySelector('#vacancy-minus')

			// percentages 
			const taxes = document.querySelector('#taxes')
			const mgmtFee = document.querySelector('#mgmt-fee')
			const vacancy = document.querySelector('#vacancy')

			// values
			const taxesCurrent = document.querySelector('#taxes-current')
			const taxesFuture = document.querySelector('#taxes-future')
			const mgmtCurrent = document.querySelector('#mgmt-fee-current')
			const mgmtFuture = document.querySelector('#mgmt-fee-future')
			const vacancyCurrent = document.querySelector('#vacancy-current')
			const vacancyFuture = document.querySelector('#vacancy-future')

			const currentGpr = document.querySelector('#gpr-current')
			const futureGpr = document.querySelector('#gpr-future')

      const inputs = Array.from(document.querySelectorAll('#os input'))
			
      inputs.forEach(function(el) {
				el.addEventListener('input', function() {
					if (isNaN(this.value)) {
						this.style.color = 'red'
					} else {
						this.style.color = 'inherit'
					}
				})
			})

			// update property taxes
			txInc.addEventListener('click', function() {
        handleChange(true, taxes, currentGpr, futureGpr, taxesCurrent,taxesFuture)
			})
			txDec.addEventListener('click', function() {
        handleChange(false, taxes, currentGpr, futureGpr, taxesCurrent,taxesFuture)
			})

			// update management fee
			mgmtInc.addEventListener('click', function() {
				handleChange(true, mgmtFee, currentGpr, futureGpr, mgmtCurrent, mgmtFuture)
			})
			mgmtDec.addEventListener('click', function() {
				handleChange(false, mgmtFee, currentGpr, futureGpr, mgmtCurrent, mgmtFuture)
			})

			// update vacancy 
			vacancyInc.addEventListener('click', function() {
				handleChange(true, vacancy, currentGpr, futureGpr, vacancyCurrent, vacancyFuture)
			})
			vacancyDec.addEventListener('click', function() {
				handleChange(false, vacancy, currentGpr, futureGpr, vacancyCurrent, vacancyFuture)
			})

			function handleChange(hasIncreased, percentInput, srcCurrent, srcFuture, targetCurrent, targetFuture) {
				const oldPercent = parseInt(percentInput.textContent)
        let newPercent = oldPercent

        if (hasIncreased) {
					newPercent = Math.min((oldPercent + 1), 100)
				} else {
					newPercent = Math.max((oldPercent - 1), 0)
				}

				if (oldPercent != newPercent) {
          targetCurrent.textContent = calculatePercentage(newPercent, parseFloat(srcCurrent.textContent))
          targetFuture.textContent = calculatePercentage(newPercent, parseFloat(srcFuture.textContent))
					percentInput.textContent = newPercent
				}
			}

			function calculatePercentage(newPercent, baseValue) {
				let multiplicator = newPercent/ 100
        return (baseValue * multiplicator).toFixed(2)
			}
		</script>
	</body>
</html>